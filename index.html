<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Keeping an exotic pet in your home!</title>
    <meta charset="utf-8" />
    <meta name="author" content="Emma Rand" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/rladies.css" rel="stylesheet" />
    <link href="libs/remark-css/rladies-fonts.css" rel="stylesheet" />
    <script src="libs/kePrint/kePrint.js"></script>
  </head>
  <body>
    <textarea id="source">





background-image: url(pics/useR2019.png)
background-position: 4% 0%
background-size: 250px


class: inverse, right, bottom

# Keeping an exotic pet in your home!
## Taming Python to live in RStudio because&lt;br&gt;sometimes the best language is both!
&lt;br&gt;
### Emma Rand&lt;br&gt;emma.rand@york.ac.uk&lt;br&gt;&lt;br&gt;Materials:   https://github.com/3mmaRand/useR2019_tutorial


---
class: center, middle

# But first.....Who am I? &lt;br&gt; and some Thank yous!

.footnote[
Materials:   https://github.com/3mmaRand/useR2019_tutorial
]
---


# Who I am?

.pull-left[

![York Lower Petergate with the cathedral in the background](https://upload.wikimedia.org/wikipedia/commons/thumb/f/fe/Lower_Petergate_in_York%2C_England.jpg/324px-Lower_Petergate_in_York%2C_England.jpg)

]

.pull-right[

Lecturer (Assistant Professor), Department of Biology University of York, UK

I'm a biologist by training. 

Long time R user, relatively new to Python. 
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
‚¨ÖÔ∏è York, twinned with Dijon.

.footnote[
Materials:   https://github.com/3mmaRand/useR2019_tutorial
]
]

---
background-image: url(pics/member_institute_logos.png)
background-position: 95% 7%

# Thank yous!

## To the local organisation committee
&lt;small&gt;
* Nathalie Vialaneix (chair), MIAT, INRA  
* S√©bastien D√©jean (vice-chair), Institut de Math√©matiques de Toulouse, Universit√© Toulouse 3 Paul Sabatier  
* Anne Ruiz-Gazen (vice-chair), Toulouse School of Economics, Universit√© Toulouse 1 Capitole  
* Heather Turner (vice-chair), statistical consultant and associate fellow of the Statistics Department at the University of Warwick  
* Aurore Archimbaud, Toulouse School of Economics  
* Christophe Bontemps, Toulouse School of Economics, INRA  
* Robert Faivre, MIAT, INRA  
* Xavier Gendre, Institut de Math√©matiques de Toulouse, Universit√© Toulouse 3 Paul Sabatier  
* Thibault Laurent, Toulouse School of Economics, CNRS  
* √âlise Maign√©, Observatoire du D√©veloppement Rural, INRA  
* Pierre Neuvial, Institut de Math√©matiques de Toulouse, CNRS  
* R√©mi Servien, InTheRes, INRA  
* Matthias Zytnicki, MIAT, INRA  
&lt;/small&gt;
.footnote[
Materials:   https://github.com/3mmaRand/useR2019_tutorial
]
---
# Thank yous! 

## For funding

.pull-left[
To the organisers and their sponsers

![useR2019 logo](pics/useR2019.png)


]

.pull-right[


![r consortium logo](pics/r_consortium.png)

My institution  

![University of York logo](pics/UoY-logo.png)

]

.footnote[
Materials:   https://github.com/3mmaRand/useR2019_tutorial
]
---
background-image: url(pics/leila.jpg)
background-position: 90% 50%
background-size: 400px
# Thank yous! 

## Leila Khajavi

.pull-left[

Leila is an American pursuing her PhD in Bioinformatics here in Toulouse, affiliated with both MIAT (INRA) and CPTP (INSERM).

She is very kindly giving her time here today to help out and has already contributed to the session by going through the material and giving some feedback.

But any errors that remain are mine!

]


.footnote[
Materials:   https://github.com/3mmaRand/useR2019_tutorial
]

---

# Thank yous! 
My colleagues at the University of York allowed me to practice on them:  
James Chong  
Bryden Fields  
Martina Stoycheva  
Jack Law  
Oliver Noble   
Rebecca Hall  
Evie Farnham  
Mike Gray  

.footnote[
Materials:   https://github.com/3mmaRand/useR2019_tutorial
]
--

And finally...

--


## Everyone here for coming! üòÑ

---

&lt;iframe src="https://docs.google.com/forms/d/e/1FAIpQLSdHXFrhsSfUXEyIhHAnP40fH5a66eRZm3YZaEcNFT-F08CKjA/viewform?embedded=true" width="640" height="650" frameborder="0" marginheight="0" marginwidth="0"&gt;Loading...&lt;/iframe&gt;


---
background-image: url(https://upload.wikimedia.org/wikipedia/commons/f/f8/Python_logo_and_wordmark.svg)
background-position: 95% 95%
background-size: 250px

# Why `reticulate`?

You finally found the **perfect** solution to a data problem!

üòÅ

.footnote[
Materials:   https://github.com/3mmaRand/useR2019_tutorial
]
--

but it's written in Python  

üò¨  

--

You're collaborating with some great people  

üòÅ  

--

but they mainly use Python!  

üò¨

You want to use existing/available solutions and collaborate more easily.

---
# Why `reticulate`?

You could move to the darkside üêç...

--

But you're familiar üíô with R...

![R logo](pics/R_logo.png)


.footnote[
Materials:   https://github.com/3mmaRand/useR2019_tutorial
]
---

# Why `reticulate`?

But you're familiar with R  
**and very at home in RStudio...**  
&amp;nbsp;  
&amp;nbsp;  
&amp;nbsp;  

![cartoon house labelled RStudio](pics/house.png)

.footnote[
Materials:   https://github.com/3mmaRand/useR2019_tutorial
]

---
# Why `reticulate`?

But you're familiar with R  
and very at home in RStudio  
**because it's comfortable...**  
&amp;nbsp;  
&amp;nbsp;  

![cartoon house labelled RStudio with sleeping cat](pics/house_cat.png)

.footnote[
Materials:   https://github.com/3mmaRand/useR2019_tutorial
]
---
# Why `reticulate`?

But you're familiar with R  
and very at home in RStudio  
because it's comfortable  
**and has many tools you like...**  
&amp;nbsp;  

![cartoon house labelled RStudio with sleeping cat and tidyverse hex stickers](pics/house_cat_tools.png)

.footnote[
Materials:   https://github.com/3mmaRand/useR2019_tutorial
]
---

# Why `reticulate`?

But you're familiar with R  
and very at home in RStudio  
because it's comfortable  
and has many tools you like  
**and the sun always shines!**  

![cartoon house labelled RStudio with sleeping cat and tidyverse hex stickers in the sun](pics/house_cat_tools_sun.png)
.footnote[
Materials:   https://github.com/3mmaRand/useR2019_tutorial
]

---
# Why `reticulate`?

So even though Python has some great tools...  
&amp;nbsp;  
&amp;nbsp;  
&amp;nbsp;  
&amp;nbsp;  

![cartoon house labelled RStudio with sleeping cat and tidyverse hex stickers in the sun](pics/house_cat_tools_sun.png)![cartoon house labelled python](pics/house_python.png)

.footnote[
Materials:   https://github.com/3mmaRand/useR2019_tutorial
]

---
# Why `reticulate`?

So even though Python has some great tools  
**and some very cool people...**  
&amp;nbsp;  
&amp;nbsp;  
&amp;nbsp;  

![cartoon house labelled RStudio with sleeping cat and tidyverse hex stickers in the sun](pics/house_cat_tools_sun.png)![cartoon house labelled python with cool cat](pics/house_python_cat.png)

.footnote[
Materials:   https://github.com/3mmaRand/useR2019_tutorial
]

---
# Why `reticulate`?


So even though Python has some great tools  
and some very cool people  
**you don't want to move in!**  
&amp;nbsp;  
&amp;nbsp;  

![cartoon house labelled RStudio with sleeping cat and tidyverse hex stickers in the sun](pics/house_cat_tools_sun2.png)![cartoon house labelled python with cool cat](pics/house_python_cat.png)

.footnote[
Materials:   https://github.com/3mmaRand/useR2019_tutorial
]

---

# Why `reticulate`?

Thankfully, there's `Reticulate`

&lt;small&gt;JJ Allaire, Kevin Ushey and Yuan Tang (2018). reticulate: Interface to 'Python'. R package version  1.10. https://CRAN.R-project.org/package=reticulate &lt;/small&gt; 

&amp;nbsp;  

![RStudio and Pythonhouses joined by the reticulate package logo](pics/house_reticulate.png)


.footnote[
Materials:   https://github.com/3mmaRand/useR2019_tutorial
]

---

class: inverse, center, middle

# Tutorial Overview

---

# Tutorial Overview üó∫

* Context: Very brief background to R üíôand Python üêç  

* Rationale: why use [Reticulate](https://rstudio.github.io/reticulate), what are its key features, how can it be used and set up  

* Background: A little Python. Only what you need to start making sense of calling Python from R  

* Using Python interactively with `repl_python()`  

* Integration in R markdown üñã:  Writing your own `reticulate` tutorial
  * Part 1: Building your understanding
  * Part 2: Classifying audio segments  

What the tutorial won't be: a thorough introduction to Python, R Markdown or machine learning.

.footnote[
Materials:   https://github.com/3mmaRand/useR2019_tutorial
]
---

&lt;iframe src="https://docs.google.com/forms/d/e/1FAIpQLSfFYrr2fN0fVRoKl0yvZUJSM3FwEZuO3ZzKLfqXtT6XvJumvQ/viewform?embedded=true" width="640" height="600" frameborder="0" marginheight="0" marginwidth="0"&gt;Loading...&lt;/iframe&gt;

---
# Aims

This tutorial was designed for:  
* beginner to intermediate R users  
* those with little to no experience of Python  
* those who may not have experience of Rmarkdown  

--

By the end of the tutorial you should be able to:
* pass objects between simultaneous R and Python sessions  
* use Python methods in R code
* incorporate Python snippets in to your R workflow even if you don't understand in detail how they work

As long as you know what the Python methods and code snippets are for, and have a good-enough understanding of their inputs and outputs, then you can use `reticulate`.

--

Some of the code is specifically designed to develop understanding of the integration rather than reflect a workflow. The later section comprises an example workflow.

---
# Background

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; R &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Python &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Released &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1995 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1991 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Author &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Ihaka &amp;amp; Gentleman, Chambers &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; van Rossum &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Purpose &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; User-friendly data analysis and visualisation for 'non-programmers' &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Object-oriented,
                                     Readable, general purpose programming language &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Users most likely to be &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Statistics graduates,  Academics, data scientists &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Computer Science graduates, Software engineers &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Features &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; R Markdown, tidyverse &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Integration with web aps, Unified Machine learning API &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

.footnote[
Materials:   https://github.com/3mmaRand/useR2019_tutorial
]
---

# Why use Reticulate

## Speed up your workflow

* Problem solving is the defining feature of a data scientist
* Language should be secondary
* Choice of language driven by early impressions of the data. Change in direction later means lost time in translating

## Facilitate collaboration

* Allows you to leverage the skills expertise of the whole team
* Solves the hardest problem in Data Science - People&lt;sup&gt;1&lt;/sup&gt;. 
* Many Data Scientists know both and they are happier&lt;sup&gt;2&lt;/sup&gt;

.footnote[
[1] Mangano, 2019  
[2] Stack Overflow Developers' Survey, NanoMathius, 2018  
]


---
# Reticulate

## Key features

1. Ability to call Python from R  

2. Translation between R objects and Python objects  
 
3. Flexible binding to different Python environments  


---
# Reticulate

## Alllows you to use Python in four ways:  

1. Interactively in the console: `repl_python()`  

2. Sourcing Python scripts  

3. Importing Python modules  

4. In R Markdown documents  

--

We will start with `repl_python()` to build our understanding.

Then use R Markdown.

---
# Reticulate

## Ingredients

You will need

* [RStudio 1.2](https://www.rstudio.com/products/rstudio/)  
   1.2 is needed for some of the most useful features

--

* Python  
  [Anaconda 3](https://www.anaconda.com/distribution/) 
    recommended for data science, includes many useful libraries.

--

* The `reticulate` package. I recommend  using the development version
   
   ```r
   devtools::install_github("rstudio/reticulate")  
   ```

.centre[
![reticulate-logo](pics/reticulated_python.png)
]


---
background-image: url(https://upload.wikimedia.org/wikipedia/en/c/cd/Anaconda_Logo.png)
background-position: 10% 30%
background-size: 280px

# This one

--

.pull-right[
![snake](pics/anconda-1.jpg) 

**Not this one**
]


---

# Reticulate

## You will also need


*  Any other Python modules your Python code depends on (not needed here)

--

* Probably / possibly.....to set to the QT_PLUGIN_PATH environment variable.  

  In windows: Control Panel -&gt; System and Security -&gt; System then

  Advanced System settings -&gt; Environment variables

  I have set mine to:
  
  `C:\Program Files\RStudio\bin\plugins; C:\ProgramData\Anaconda3\Library\plugins`


.footnote[
If you can describe and resolve in a better but still minimal way, please get in touch!
]
---

# Reticulate

## In windows: QT_PLUGIN_PATH environment variable

![ QT_PLUGIN_PATH environment variable in Advanced System settings](pics/env_variables.png)

---
# Reticulate

## In windows: QT_PLUGIN_PATH environment variable

If you get this error: 

.pull-left[
**This application has failed to start because it could not find or load the qt platform plugin "windows" in "" **
]

.pull-right[
![](pics/QT_error.png)
]

Setting the QT_PLUGIN_PATH environment variable as on the previous slide should fix it.

.footnote[
If you can describe and resolve in a better but still minimal way, please get in touch!
]

---

class: inverse, center, middle

# A little Python

---
background-image: url(pics/cute-snake.jpg)
background-position: 95% 7%


# Python fundamentals
Suppose you wanted to created an array of 5 numbers. 

In R you might do this as:

```r
r_array &lt;- c(4, 5, 1, 6, 8)
```

--
In Python you might use a list&lt;sup&gt;1&lt;/sup&gt;

A list is created like this:

```python
python_list = [4, 5, 1, 6, 8]
```


.footnote[
[1] Python doesn't have a native array data structure
]

--

Python uses `=` for assignment

--

The square brackets denote a list
---
background-image: url(pics/cute-snake.jpg)
background-position: 95% 7%

# Python fundamentals

But lists do not behave as a R user might expect.

For example, what would you expect the output to be?


```python
python_list = [4, 5, 1, 6, 8]
*python_list * 2
```

--

This?

```python
python_list = [4, 5, 1, 6, 8]
python_list * 2
*[8, 10, 2, 12, 16]
```

--
Infact it is this:

```python
python_list = [4, 5, 1, 6, 8]
python_list * 2
*[4, 5, 1, 6, 8, 4, 5, 1, 6, 8]
```


ü§Ø

---
background-image: url(pics/cute-snake.jpg)
background-position: 95% 7%

# Python fundamentals

Instead you might use the [NumPy package](http://www.numpy.org/)&lt;sup&gt;1&lt;/sup&gt;. NumPy arrays behave like R vectors/arrays.

.footnote[
[1] NumPy is the fundamental package for scientific computing with Python. It is part of the 
SciPy ecosystem.  
Jones E, Oliphant E, Peterson P, et al. SciPy: Open Source Scientific Tools for Python, 2001-, http://www.scipy.org/.
]
--

To make a NumPy array we need to first`import` NumPy, then use it's `array()` function. 

This is going to introduce us to several Pythonesque things.

---
background-image: url(pics/cute-snake.jpg)
background-position: 95% 7%


# Python fundamentals


The Python code looks like this:

```python
import numpy as np
python_array = np.array([4, 5, 1, 6, 8])
```

---
background-image: url(pics/cute-snake.jpg)
background-position: 95% 7%


# Python fundamentals


The Python code looks like this:

```python
*import numpy as np
python_array = np.array([4, 5, 1, 6, 8])
```


`import` in Python is the equivalent of `library()` in R

--

To use methods in NumPy (and other modules) we need to use the "dot" notation:

`numpy.method_name()`

To make this quicker to type it is common to use an alias. That's the `as np` bit

---
background-image: url(pics/cute-snake.jpg)
background-position: 95% 7%

# Python fundamentals


```python
import numpy as np
*python_array = np.array([4, 5, 1, 6, 8])
```

The second line of code creates the numpy array (from a list).

--

To do things with `python_array` we might use a built-in function. These are used in a way that will be familar to you, for example:


```python
type(python_array)
&lt;class 'numpy.ndarray'&gt;
```
  
--

Python also has methods. Methods are called on objects with the dot notation.  
For example:


```python
python_array.max()
8
```
---

class: center, middle

# Enough!&lt;br&gt; &lt;br&gt;Let me code

## We will cover some more Python as we go through the tutorial.
---

class: inverse, center, middle

# Using Python in the console
## `reticulate::repl_python()`
---

# Using Python in the console

## Steps

We are going to use Python interactively in the console.  

We will 
* Create a new project  
* Check our Python environment  
* Start a Python session from our R session  
* Create a NumPy array  
* Use the NumPy array  
  * find its size (an attribute)   
  * calculate its mean (a method)  
* End the Python session  
* Access the NumPy array from our R session  

.footnote[
&lt;span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: purple !important;" &gt;Extra exercise&lt;/span&gt; Indicates an optional extra exercise to try while you're waiting for me to move on.
]

---
# Using Python in the console

## Organising ourselves

.pull-left[
We are going to work in a project&lt;sup&gt;1&lt;/sup&gt;.

File | New Project | Existing Directory

Choose Browse

And navigate to the "music_ml" folder and Open
]

.pull-right[
![rstudio's Create Project from Existing Directory window](pics/new_project.png)

]

Choose Create Project

.footnote[
[1] New to projects? [RStudio: Using Projects](https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects)
]


---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# Using Python in the console

We are going to be moving between Python and R sessions.

Which could get confusing!

--

What session you are in **at the start of a slide** is indicated like this:

.pull-left[

## üêç _Sub-heading_
You are working interactively with python and your prompt should look like this: 

```r
&gt;&gt;&gt;
```
You may **finish** the slide in an R session
]

--
.pull-right[

## üíô _Sub-heading_
You are working interactively with R and your prompt should look like this:

```r
&gt;
```
You may **finish** the slide in a Python session
]


---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# Using Python in the console

## üíô Prepare to start a Python session

Load the reticulate package

```r
&gt; library(reticulate)
```

For this section on using `repl_python()` I will show the prompt, either `&gt;` or`&gt;&gt;&gt;` in the code.

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# Using Python in the console

## üíô Start a Python session

With `repl_python()`:


```r
&gt;  repl_python() 
Python 3.7.3 (C:\PROGRA~3\ANACON~1\python.exe)
Reticulate 1.12.0.9003 REPL -- A Python interpreter in R
&gt;&gt;&gt;  
```

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# Using Python in the console

## üêç repl_python()


```r
&gt;  repl_python() 
*Python 3.7.3 (C:\PROGRA~3\ANACON~1\python.exe)
*Reticulate 1.12.0.9003 REPL -- A Python interpreter in R
&gt;&gt;&gt;  
```

* You get a message to tell you what version of Python you're using and where it is  

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# Using Python in the console

## üêç repl_python()


```r
&gt;  repl_python() 
Python 3.7.3 (C:\PROGRA~3\ANACON~1\python.exe)
Reticulate 1.12.0.9003 REPL -- A Python interpreter in R
*&gt;&gt;&gt;  
```

* You get a message to tell you what version of Python you're using and where it is.  

* `&gt;&gt;&gt;` indicates the Python prompt.  

--

We need to use Python 3.

By default, `reticulate` uses the version of Python found on your PATH. 

--

If Python 3 is not being used (possibly Mac users) we can change it.

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# Using Python in the console

## üêç Change the Python version.

It is not necessary to do this if you're already using Python 3 but it won't hurt if you do.

End the `repl_python` session:


```r
&gt;&gt;&gt; exit
&gt;
```

--
## üíô 

Set the version of Python you want to use. 

This needs to be where Anaconda3 installed. In my case:


```r
&gt; use_python("C:/ProgramData/Anaconda3/python.exe")
```

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# Using Python in the console

## üíô Check the Python version

Confirm it has been set:


```r
&gt; Sys.which("python")
                              python 
"C:\\PROGRA~3\\ANACON~1\\python.exe" 
```

On windows machines the paths will be short paths (8+3 components, no spaces) with \ as the path delimiter. 

In my case, it is short for `C:/ProgramData/Anaconda3/python.exe`

So I know I'm using Python 3

--

With `repl_python()`:


```r
&gt;  repl_python() 
Python 3.7.3 (C:\PROGRA~3\ANACON~1\python.exe)
Reticulate 1.12.0.9003 REPL -- A Python interpreter in R
&gt;&gt;&gt;  
```

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# Using Python in the console

## üêç Make a NumPy array


Import the [NumPy package](http://www.numpy.org/)
.pull-left[

```r
&gt;&gt;&gt; import numpy as np
&gt;&gt;&gt; 
```
]

.pull-right[
You get command completion!
]

.footnote[
&lt;span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: purple !important;" &gt;Extra exercise 1.&lt;/span&gt; Create a list called `python_list`  
&lt;span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: purple !important;" &gt;Extra exercise 2.&lt;/span&gt; Import pandas and create a small data frame. You'll need the DataFrame() method from pandas. As arguments, it will take lists of lists the same length
]

--

and create an array in the console

```r
&gt;&gt;&gt; python_array = np.array([4, 5, 1, 6, 8])
&gt;&gt;&gt; 
```
--

#### Success! üéá 

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# Using Python in the console

## Oh! üòï
But nothing appears in your R environment!
  
![](pics/empty_env.png)

.footnote[
&lt;span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: purple !important;" &gt;Extra exercise 1.&lt;/span&gt; Create a list called `python_list`  
&lt;span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: purple !important;" &gt;Extra exercise 2.&lt;/span&gt; Import pandas and create a small data frame. You'll need the DataFrame() method from pandas. As arguments, it will take lists of lists the same length
]

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# Using Python in the console

## üêç Where is our NumPy array?
Can Python can find it? 
####üîé

.footnote[  
&lt;span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: purple !important;" &gt;Extra exercise 3.&lt;/span&gt; How do you need to organise the list of lists in the DataFrame() command to get a 4 rows and 2 columns compared to 2 rows and 4 columns.
]

--


```r
&gt;&gt;&gt; python_array
array([4, 5, 1, 6, 8])
&gt;&gt;&gt;
```
--
#### üëç üôå

Great, the Python session can see it!


---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# Using Python in the console

## üêç Work with a NumPy array

Check the object type of `python_array`:


```r
&gt;&gt;&gt; type(python_array)
&lt;class 'numpy.ndarray'&gt;
&gt;&gt;&gt; 
```

--

Find the size of `python_array` with:


```r
&gt;&gt;&gt; python_array.size
5
&gt;&gt;&gt;
```

.footnote[
&lt;span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: purple !important;" &gt;Extra exercise 4.&lt;/span&gt; What does `.size` give for the the list and dataframe? Try `.shape`
]

--

`size` is an *attribute* or *value* of NumPy arrays. 

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# Using Python in the console


## üêçWork with a NumPy array

Can you find the mean of `python_array`?
.footnote[
&lt;span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: purple !important;" &gt;Extra exercise 5.&lt;/span&gt; Find other summary statistics for the array  
&lt;span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: purple !important;" &gt;Extra exercise 6.&lt;/span&gt; Is there a mean method for the dataframe? What about the list? Can you find the mean of your list?
]
--


```r
&gt;&gt;&gt; python_array.mean()
4.8
&gt;&gt;&gt;
```
`mean()` is an *method* of NumPy arrays.

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# Using Python in the console

## üêç Bye bye Python

Let's exit Python

```r
&gt;&gt;&gt; exit
&gt;
```

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# Using Python in the console

## üíô Hello R

&amp;nbsp;


```r
&gt;&gt;&gt; exit
*&gt;
```

The R prompt is returned
---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# Using Python in the console

## üíô Now where is `python_array`?

.pull-left[
![](pics/empty_env.png) 
]

.pull-right[
Our environment is still empty
]

--

But we **can** access the Python object using `py$...`


```r
&gt; py$python_array
[1] 4 5 1 6 8
```

.footnote[
&lt;span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: purple !important;" &gt;Extra exercise 7.&lt;/span&gt; Can you access the list and dataframe?
]

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# Using Python in the console

## üíô Accessing python-created objects

And we have normal command completion so typing `py$` followed by the TAB key ‚≠æ will list the available python objects.


![image of command completion for py$ showing np, python_array, r, R, sys](pics/command_completion2.png)

--

Notice we have more than `python_array`. 

We will return to this in a few slides.

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# Using Python in the console

## üíô Accessing python-created objects

`reticulate` makes these python-created objects behave how you expect them to in R.


```r
&gt; py$python_array * 2
[1]  8 10  2 12 16
```


```r
&gt; py$python_array * py$python_array
[1] 16 25  1 36 64
```

.footnote[  
&lt;span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: purple !important;" &gt;Extra exercise 8.&lt;/span&gt; How do the list and dataframe behave? 
]

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# Using Python in the console

## üíô R functions on python-created objects

They behave the way you expect them to because they are converted R objects
when used!


```r
&gt; class(py$python_array)
[1] "array"
```
--

`py$python_array` is a one-dimensional array

.footnote[   
&lt;span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: purple !important;" &gt;Extra exercise 9.&lt;/span&gt; What is the object translation for the list and dataframe?
]
--

numpy.ndarray `\(\rightarrow\)` array

--

And look! üëÄ
We can use R functions on python-created objects


---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# Using Python in the console

## üíô R functions on python-created objects

The mean...


```r
&gt; mean(py$python_array)
[1] 4.8
```

--
... and length of the array

```r
&gt; length(py$python_array)
[1] 5
```


---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# Using Python in the console

## üíô R functions on python-created objects

You can assign the python object explicitly


```r
&gt; r_array &lt;- py$python_array
```

![the r environment showing the newly created r_array](pics/r_env.png)
---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# Using Python in the console

## üíô Python methods on python-created objects

Remember this?
![image of command completion for py$ showing np, python_array, r, R, sys](pics/command_completion2.png)

We have access to the `np` object which results from importing `NumPy` as `np` in our Python session.

This gives us access to all the NumPy attributes and methods.


---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# Using Python in the console

## üíô Python methods on python-created objects

.pull-left[

üêç In Python `np` attributes are applied by following the object with a dot: 

_`object_name.attribute_name`_

For example, we found the size of `python_array` with:


```r
&gt;&gt;&gt; python_array.size
5
```
]
.footnote[   
&lt;span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: purple !important;" &gt;Extra exercise 10.&lt;/span&gt; Create a vector, array and/or dataframe in R then restart `repl_python()` and access them in the Python session with `r.` 
]
--
.pull-right[

üíô In R we access and apply `np` attributes in a R like way: 

`py$np$` _`attribute_name(object_name)`_

So to use the size attribute on `py$python_array`:


```r
&gt; py$np$size(py$python_array)
[1] 5
```
]

--
 
**This would be a strange thing to do!** 
---

background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# Using Python in the console

## Why strange??

Because if you already have a python-created object on which you wanted to use some Python methods before doing further work in R, you would more naturally

* Use those methods in Python in a Python way  
* Then access the result in R for further work  

.footnote[   
&lt;span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: purple !important;" &gt;Extra exercise 11.&lt;/span&gt; In your `repl_python` session, apply R functions to the  data structures made in the R session 
]
--

Than
* access the object in R
* apply python methods to a python object in an R-like way in an R session
* Then do your further work



---
class: inverse, center, middle

# How: Using Python in R Markdown

## 

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Aim

You are going to write your own `reticulate` tutorial by combining your own notes and investigations with the code given in the slides.

--

The tutorial will be in two parts:
* The first part of the tutorial aims to develop our baseline understanding of the link between the R and Python sessions and running code chunks interactively. We will pass simple objects between sessions more than you would normally just for demonstration purposes

--

* The second part covers the importing, modelling and visualisation of processed audio data.

--

The tutorial is "Classification of Audio segments by instrument: A Tutorial on using the R package reticulate to integrate R and Python."

You are aiming for something like this: [Classifiying_music.html](music_ml/Classifiying_music.html)

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## The data

We are going to work with some data derived from 9 pieces of music. Three examples are:

* [Chopin - Ballade No. 1 in G Minor](https://www.youtube.com/watch?v=Zj_psrTUW_w) 
* [Corelli - Sonata da Chiesa, Op. 1 No. 1 in F major](https://www.youtube.com/watch?v=0fLbzkBRywU)
* [Mozart - Sonata in F major for piano and violin K 376](https://www.youtube.com/watch?v=iOq_lZWD8Lg)

--

The example and the original Python code to process the audio files and carry out the machine learning analysis methods are by Michael Knight, University of Bristol. 

--

Each of the pieces of music has been segmented into 5-second segments each of which has 5000 features. The features represent the apodised power spectrum of a 5-second segment. 

We will try to classify these segments.  


---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## The data

Up to 100 segments were taken from each audio file although there are fewer for pieces shorter than 500 seconds.

&lt;table class="table" style="font-size: 13px; margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Instrument &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Piece &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Number of segments &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Piano &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 01 Ballade No. 1, Op. 23.m4a &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 100 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Piano &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1-01 Sonata No. 1 In F Sharp Minor, Op. 11_ I. Introduzione. un Poco Adagio ,Allegro Vivace.m4a &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 100 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Piano &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 5-01 Beethoven_ Piano Sonata No. 14 in C-Sharp Minor, Op. 27 No. 2, 'Moonlight'_ I. Adagio sostenuto.m4a &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 74 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Piano &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 9-05 Beethoven_ Piano Sonata No. 29 in B-Flat Major, Op. 106, 'Hammerklavier'_ I. Allegro.m4a &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 100 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Violin &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 05 No.2 in A major RV 31_ I. Preludio a Capriccio. Presto.m4a &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 14 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Violin &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1-01 Sonata da chiesa a tre in F Major, Op. 1, No. 1_ I. Grave.m4a &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 15 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Violin &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1-02 Sonata da chiesa a tre in F Major, Op. 1, No. 1_ II. Allegro.m4a &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 18 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Violin &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 24 No.11 in D major RV 9_ II. Fantasia. Presto.m4a &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 16 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Violin and Piano &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3-01 Sonata for Piano and Violin in F, K. 376_ I. Allegro.m4a &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 59 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## The data

There are two xlsx files for each piece.

* *name*_segments.xlsx  
  has the segments in rows and the features in columns
* *name*_SegmentInfo.xlsx  
  has the metadata for each segment: the name of the piece, the instrument label on the piece, the start and end time of the segment.  

--

There are 496 segments in total of which 374 are from piano pieces and 63 are from violin pieces. The remaining 59 pieces are from Mozart's  Sonata piano and violin.


---
background-image: url(pics/rmarkdown.png)
background-position: 95% 5%
background-size: 100px

# How: Using Python in R Markdown

## What is R Markdown

### Live demo
May not be needed depending on the audience responses from earlier.


Just watch for a while....

---

background-image: url(pics/rmarkdown.png)
background-position: 95% 5%
background-size: 100px

# How: Using Python in R Markdown

## What is R Markdown

### Key points from the demo

* blends narrative text with analysis code and output  
* human readable  
* YAML header between the  \-\-\-
* code chunk options control whether the code and its output end up in your 'knitted' document  
* comments   
  * in a code chunk the \# is still used for comments  
  * in the text a comment is written like this  &lt;!\-\- a comment \-\-&gt;
  * but use Ctrl+Shift+C  
* \# in the text indicate headings  



---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Make your own R markdown doc

File | New File | R Markdown

Add a title.

You could use your own or copy and paste a title from [Classifiying_music.html](music_ml/Classifiying_music.html)

Add your name


--

Delete everything except:  
* the YAML header between the  \-\-\-  
* the first code chunk which begins:  
  ` ```{r setup, include=FALSE} `


---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Set up your default code chunk behaviour

That first code chunk is for setting some **default** code chunk options. 

I often use these:


````
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      warning = FALSE,
                      message = FALSE)
```
````
--

`echo = FALSE` means the code will not be included by default - this is normally what you want in a report.

--

However, I used `echo = TRUE` in [Classifiying_music.Rmd](music_ml/Classifiying_music.Rmd) so you could see the code.

Any output is included by default
 
---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Start adding some text

Add a little introduction.  

You can make your own notes or copy and paste from [Classifiying_music.html](music_ml/Classifiying_music.html)  

**Save your file** The Save directory will be the Project directory, "music_ml". Do not change that!

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Add an R chunk

The second code chunk in an Rmd document typically loads the required packages.

--

There's one package you will definitely need: `reticulate`

We also also use `readxl`&lt;sup&gt;1&lt;/sup&gt; and `ggplot2`&lt;sup&gt;2&lt;/sup&gt; so let's add those too:

.footnote[
[1] Wickham, H. Bryan, J. (2019). readxl: Read Excel Files. R package version 1.3.1. https://CRAN.R-project.org/package=readxl  
[2] Wickham, H. (2016) ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag New York https://ggplot2.tidyverse.org
]
--
.pull-left[

````
```{r pkgs}
##########   R    ##########
library(reticulate)
library(readxl)
library(ggplot2)
```
````
]

.pull-right[
Use Insert | R to add a code chunk. From now on 
.pull-left[
&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: deepskyblue !important;" &gt;Insert R chunk&lt;/span&gt;
]
.pull-right[
&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: greenyellow !important;" &gt;Insert Python chunk&lt;/span&gt;
]
]


---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Run a R chunk!

To run R commands interactively in a R Markdown document we need to run this code chunk.

Use the green arrow on the right of the chunk to run it.

![r pkgs code chunk with the run code green arrow on the right indicated](pics/run_chunk_r.png)

From now on  
&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lavender !important;" &gt;=&amp;gt; Run Chunk&lt;/span&gt;  
means use the green button to run the chunk.

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Run a line in a chunk

Sometimes we will modify a chunk. In this case, you don't need to run the whole chunk, just the added line. You can do this by selected the line and doing Ctrl-enter&lt;sup&gt;1&lt;/sup&gt;

![r pkgs code chunk with one line selected and Ctrl-enter indicated](pics/run_chunk_line.png)

From now on  
&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lavender !important;" &gt;=&amp;gt; Run added line&lt;/span&gt;  
means you don't need to run the whole chunk, just the most recently added line. 

.footnote[
[1] Unless you have set the short cut to something else.
]

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Add a Python chunk

Now we'll add a chunk to import the Python modules we will need.

In Part 1, we will use the `OS` module which provides a way of using operating system dependent functionality.

--

.pull-left[
&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: greenyellow !important;" &gt;Insert Python chunk&lt;/span&gt;
````
```{python mods}
########## PYTHON ##########
import os
```
````

]
.pull-right[

&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lavender !important;" &gt;=&amp;gt; Run Chunk&lt;/span&gt;
]

--

Feeling unnerved by not being able to see that anything has happened?

You can check the Python session on the command line in the console: `py$` should give you command completion options which include `py$os`

--

We will add any other Python modules we need later.

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Part 1 Building our understanding

If you get the error:

This application has failed to start because it could not find or load the qt platform plugin "windows" in ""

You may need to check QT_PLUGIN_PATH (see earlier slide)

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Part 1 Building our understanding

You may want to add a header indicating this is Part 1 of the tutorial

--

A Python equivalent for R's `getwd()` is `getcwd()` from the `os` module.

--

If you have successfully imported the `os` module you can use it like this:


.pull-left[
&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: greenyellow !important;" &gt;Insert Python chunk&lt;/span&gt;
````
```{python}
########## PYTHON ##########
os.getcwd()
```
 'C:\\Users\\Emma Rand\\Desktop\\useR2019\\useR2019_tutorial\\music_ml'
````
]
.pull-right[
&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lavender !important;" &gt;=&amp;gt; Run Chunk&lt;/span&gt;
]

--

It prints out! 

On a windows machine the 'windows-way' round slashes are escaped  
On a mac the path will be given 'correctly'


---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Part 1 Building our understanding

We can also use the the `getcwd()` method from `os` in a R chunk.

--

Remember, to access Python objects (of any sort) in R we use `py$`

Here we access the `os` object's methods 

--

BUT in a R-like way using the `$` not a `.`

.pull-left[
&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: deepskyblue !important;" &gt;Insert R chunk&lt;/span&gt;
````
```{r}
##########   R    ##########
py$os$getcwd()

```
 [1] "C:\\Users\\Emma Rand\\Desktop\\useR2019\\useR2019_tutorial\\music_ml"
````
]
.pull-right[

&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lavender !important;" &gt;=&amp;gt; Run Chunk&lt;/span&gt;
]

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Part 1 Building our understanding

And we access R functions in Python chunks in a Python-like way

Can you do that? 

--

.pull-left[
&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: greenyellow !important;" &gt;Insert Python chunk&lt;/span&gt;
````
```{python}
########## PYTHON ##########
r.getwd()
```
 'C:/Users/Emma Rand/Desktop/useR2019/useR2019_tutorial/music_ml'
````
]
.pull-right[

&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lavender !important;" &gt;=&amp;gt; Run Chunk&lt;/span&gt;
]


That's right! Though I'm not sure quite why you would!

--

üëÄ You might have noticed that the output of Python chunks doesn't include the element numbering [1] characteristic of R output.

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Part 1 Building our understanding

We will read one of the spectrum files to learn how to access dataframes in both sessions using `read_excel()` from `readxl`:


.pull-left[
&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: deepskyblue !important;" &gt;Insert R chunk&lt;/span&gt;
````
```{r}
##########   R    ##########
spectrum &lt;- read_excel("Piano/01 Ballade No. 1, Op. 23_segments.xlsx")
```
````

]
.pull-right[

&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lavender !important;" &gt;=&amp;gt; Run Chunk&lt;/span&gt;
]

--

Check the dimensions of the dataframe

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Part 1 Building our understanding



.pull-left[
&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: deepskyblue !important;" &gt;Modify R Chunk&lt;/span&gt;
````
```{r}
##########   R    ##########
spectrum &lt;- read_excel("Piano/01 Ballade No. 1, Op. 23_segments.xlsx")
dim(spectrum)
```
[1] 100 5001
````

]
.pull-right[

&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lavender !important;" &gt;=&amp;gt; Run Chunk&lt;/span&gt;
]

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Part 1 Building our understanding

Can you access the `spectrum` dataframe in a Python chunk and find out what type of object it is in the Python session?

--

   Hint: the dataframe is `r.spectrum`

--

.pull-left[
&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: greenyellow !important;" &gt;Insert Python chunk&lt;/span&gt;

````
```{python}
########## PYTHON ##########
type(r.spectrun)
```
&lt;class 'pandas.core.frame.DataFrame'&gt;
````
]
.pull-right[

&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lavender !important;" &gt;=&amp;gt; Run Chunk&lt;/span&gt;
]
---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Part 1 Building our understanding

It is a `Pandas`&lt;sup&gt;1&lt;/sup&gt; dataframe. 

Pandas is a module that provides dataframe data structures and analysis tools for working with them. A Pandas dataframe is just like an R dataframe.

.footnote[
[1] McKinney, W. (2010) Data Structures for Statistical Computing in Python, Proceedings of the 9th Python in Science Conference, 51-56 
]
--

In R, we access the column of a dataframe with `dataframe$colname`

--

In Python we access a Pandas dataframe column with `dataframe["colname"]`



---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Part 1 Building our understanding

Can you use Python's `shape` in a new python chunk to determine the dimensions of the dataframe?

--

   Hint: Python methods are aplied with the dot notation

--

.pull-left[
&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: greenyellow !important;" &gt;Insert Python chunk&lt;/span&gt;

````
```{python}
########## PYTHON ##########
r.spectrum.shape
```
(100, 5001)
````

]
.pull-right[

&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lavender !important;" &gt;=&amp;gt; Run Chunk&lt;/span&gt;
]

That's right!

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Part 1 Building our understanding

* 100 rows _i.e._, segments. 
* 5001 columns. The first column (curiously named "...1") is the segment label; the others are the 5000 features. They have the names "0" to "4999"

Using R to find the mean and s.d. of the second feature&lt;sup&gt;1&lt;/sup&gt;

.footnote[
[1] There's nothing special about feature 2. I'm avoiding the first feature simply because it is atypical
]

--


.pull-left[
&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: deepskyblue !important;" &gt;Insert R Chunk&lt;/span&gt;
````
```{r}
##########   R    ##########
mean(spectrum$`1`)
sd(spectrum$`1`)
```
[1] 4422.34
[1] 5711.785
````

]
.pull-right[

&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lavender !important;" &gt;=&amp;gt; Run Chunk&lt;/span&gt;
]


---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Part 1 Building our understanding

Can you use Python to achieve the same:

--

   Hint: the columns of pandas dataframes are accessed with `dataframe["colname"]`

--

.pull-left[
&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: greenyellow !important;" &gt;Insert Python Chunk&lt;/span&gt;
````
```{python}
########## PYTHON ##########
r.spectrum["1"].mean()
r.spectrum["1"].std()
```
4422.34
5711.784974979717
````

]
.pull-right[

&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lavender !important;" &gt;=&amp;gt; Run Chunk&lt;/span&gt;
]

Well done!

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Part 1 Building our understanding

### Knit your Rmd

Now is a good time to hit knit!
---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Part 1 Building our understanding

Now read in the same file using Python. We will use Python in the second part of the tutorial to read in all our data.

--

You'll need to first add the `Pandas` module to your list of import statements in the Python chunk called mods

--

.pull-left[
&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: greenyellow !important;" &gt;Modify Python Chunk&lt;/span&gt;
````
```{python mods}
########## PYTHON ##########
import os
import pandas as pd
```
````

]
.pull-right[

&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lavender !important;" &gt;=&amp;gt; Run Chunk&lt;/span&gt;
]


---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Part 1 Building our understanding

Read in the file:

.pull-left[
&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: greenyellow !important;" &gt;Insert Python Chunk&lt;/span&gt;
````
```{python}
########## PYTHON ##########
python_spectrum = pd.read_excel("Piano/01 Ballade No. 1, Op. 23_segments.xlsx")
```
````

]
.pull-right[

&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lavender !important;" &gt;=&amp;gt; Run Chunk&lt;/span&gt;
]


---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Part 2 Classification of audio data

### Data import
This will be carried out with Python. 

**Overivew**  
The nine "_segments.xlsx" files are read in to a single Pandas dataframe, `df_seg`.

--

This requires nested `for` loops to iterate through the directories and through the files in the directories. 

The information about the segments in "_SegmentInfo.xlsx" files are similarly read into a Pandas dataframe, `df_info` and a column is added to capture the instrument labeling.

You should be able to use and run the Python code without understanding how it works.

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Part 2 Classification of audio data

### Data import
Copy the importing code from: [Classifiying_music.html](music_ml/Classifiying_music.html) and paste the code in to a Python chunk

.pull-left[
&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: greenyellow !important;" &gt;Insert Python Chunk&lt;/span&gt;
````
```{python}
########## PYTHON ##########
dirs_to_use = ["Violin", "Piano", "Violin_and_Piano"]

df_seg = None
df_info = None
for d in dirs_to_use:
    for f in os.listdir(d):
    ... ... ...
    ... ... ... etc
    
```
````

]
.pull-right[

&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lavender !important;" &gt;=&amp;gt; Run Chunk&lt;/span&gt;
]
---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Part 2 Classification of audio data

At this point you might want to verify you have the pandas dataframe.

--

You can use `repl_python()` in the console



```r
&gt;  repl_python() 
Python 3.7.3 (C:\PROGRA~3\ANACON~1\python.exe)
Reticulate 1.12.0.9003 REPL -- A Python interpreter in R
&gt;&gt;&gt; type(df_seg)
&lt;class 'pandas.core.frame.DataFrame'&gt;
&gt;&gt;&gt; df_seg.shape
(496, 5001)
&gt;&gt;&gt; type(df_info)
&lt;class 'pandas.core.frame.DataFrame'&gt;
&gt;&gt;&gt; df_info.shape
(496, 6)  
```

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Part 2 Classification of audio data

Or add a chunk

.pull-left[
&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: greenyellow !important;" &gt;Insert Python Chunk&lt;/span&gt;
````
```{python}
########## PYTHON ##########
type(df_seg)
df_seg.shape
type(df_info)
df_info.shape
```
&lt;class 'pandas.core.frame.DataFrame'&gt;
(496, 5001)
&lt;class 'pandas.core.frame.DataFrame'&gt;
(496, 6)
````

]
.pull-right[

&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lavender !important;" &gt;=&amp;gt; Run Chunk&lt;/span&gt;
]
---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Part 2 Classification of audio data

### Knit your Rmd

Now is good time to hit knit!

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Part 2 Classification of audio data

**Principal Component Analysis (PCA) in Python**

You'll need to first add PCA from the `scikit-learn`&lt;sup&gt;1&lt;/sup&gt; module to your list of import statements in the Python chunk called mods

.footnote[
[1] Pedregosa et al. (2011) Scikit-learn: Machine Learning in Python. JMLR 12: 2825-2830 http://jmlr.csail.mit.edu/papers/v12/pedregosa11a.html
]
--

.pull-left[
&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: greenyellow !important;" &gt;Modify Python Chunk&lt;/span&gt;
````
```{python mods}
########## PYTHON ##########
import os
import pandas as pd

# for PCA
from sklearn.decomposition.pca import PCA
```
````

]
.pull-right[

&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lavender !important;" &gt;=&amp;gt; Run added line&lt;/span&gt;
]



---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Part 2: PCA in Python
The PCA is carried out with

.pull-left[
&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: greenyellow !important;" &gt;Insert Python Chunk&lt;/span&gt;
````
```{python}
########## PYTHON ##########
# Apply PCA
mdl = PCA()
new_data = mdl.fit_transform(df_seg)
    
```
````

]
.pull-right[

&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lavender !important;" &gt;=&amp;gt; Run Chunk&lt;/span&gt;
]

`new_data` contains the Principle Component scores

---

background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Part 2: Visualising the üêç PCA

**First using Python.** You'll need to add the `matplotlib.pyplot`&lt;sup&gt;1&lt;/sup&gt; module to your list of import statements in the Python chunk called mods

.footnote[
[1]  Hunter, J. D. (2007). "Matplotlib: A 2D Graphics Environment", Computing in Science &amp; Engineering, vol. 9, no. 3.
]
--

.pull-left[
&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: greenyellow !important;" &gt;Modify Python Chunk&lt;/span&gt;
````
```{python mods}
########## PYTHON ##########
import os
import pandas as pd

# for PCA
from sklearn.decomposition.pca import PCA
# for plotting
import matplotlib.pyplot as plt
```
````

]
.pull-right[

&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lavender !important;" &gt;=&amp;gt; Run added line&lt;/span&gt;
]

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Part 2: Visualising the üêç PCA

First using Python

Copy the Biplot code from: [Classifiying_music.html](music_ml/Classifiying_music.html)

Insert a new Python chunk and paste the code in
.pull-left[
&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: greenyellow !important;" &gt;Insert Python Chunk&lt;/span&gt;
````
```{python}
########## PYTHON ##########
p = df_info["Instrument"] == "Piano"
v = df_info["Instrument"] == "Violin"
pv = df_info["Instrument"] == "Violin_and_Piano"
plt.figure()
... ... ...
... ... ... etc
    
```
````

]
.pull-right[

&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lavender !important;" &gt;=&amp;gt; Run Chunk&lt;/span&gt;
]

You should see the Python plot in your file!

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Part 2: Visualising the üêç PCA

### Knit your Rmd

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Part 2: Visualising the üêç PCA

Now using R!

Insert a new R chunk: 
.pull-left[
````
```{r}
##########   R    ##########
df &lt;- data.frame(pca1 = py$new_data[ ,1],
                 pca2 = py$new_data[ ,2],
                 instrument = py$df_info$Instrument)

ggplot(data = df, aes(x = pca1, y = pca2, color = instrument)) +
  geom_point()
    
```
````

]
.pull-right[

&lt;span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lavender !important;" &gt;=&amp;gt; Run Chunk&lt;/span&gt;
]

You should see the R plot in your file!
---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# How: Using Python in R Markdown

## Part 2: Visualising the üêç PCA

### Knit your Rmd

Epic! Python and R plots in one doc!

---
background-image: url(pics/reticulated_python.png)
background-position: 95% 7%

# The End, Congratulations!

By the end of the tutorial you should be able to:  

* pass objects between simultaneous R and Python sessions  

* use Python methods in R code  

* incorporate Python snippets in to your R workflow even if you don't understand in detail how they work  

## Python scripts
* [tutorial_code_sklearn.py](tutorial_code_sklearn.py)  
  Lots more machine learning methods applied to this data
* [SoundSegment.py](SoundSegment.py)  
  The class that processed audio
* [generateSegments.py](generateSegments.py)  
  script that calls SoundSegment.py and outputs all the xlsx files
  
 
  
---
## References and credits

&lt;small&gt;
* Allaire, J.J., Xie, Y., McPherson, J., Luraschi, J., Ushey, K., Atkins, A., Wickham, H., Cheng, J., Chang, W. and Iannone, R. (2019). rmarkdown: Dynamic Documents for R. R  package version 1.12. URL https://rmarkdown.rstudio.com.
* Jones E, Oliphant E, Peterson P, et al. SciPy: Open Source Scientific Tools for Python, http://www.scipy.org/
* Kaggle.com. (2019). Kaggle Machine Learning &amp; Data Science Survey 2017. [online] Available at: https://www.kaggle.com/kaggle/kaggle-survey-2017 [Accessed 5 Jul. 2019].
* Kaggle.com. (2019). Predicting R vs. Python | Kaggle. [online] Available at: https://www.kaggle.com/nanomathias/predicting-r-vs-python/notebook [Accessed 5 Jul. 2019].
* McKinney, W. (2010) Data Structures for Statistical Computing in Python, Proceedings of the 9th Python in Science Conference, 51-56
* Mangano, A. (2019). The Reticulate Package Solves the Hardest Problem in Data Science: People. [Blog] R Views. Available at: https://rviews.rstudio.com/2019/03/18/the-reticulate-package-solves-the-hardest-problem-in-data-science-people/ [Accessed 5 Jul. 2019].
* Pedregosa et al. (2011). Scikit-learn: Machine Learning in Python. JMLR 12: 2825-2830 http://jmlr.csail.mit.edu/papers/v12/pedregosa11a.html
* Python Software Foundation. Python Language Reference, version 2.7. Available at http://www.python.org
* R Core Team (2018). R: A language and environment for statistical computing. R Foundation for Statistical Computing, Vienna, Austria. URL https://www.R-project.org/.
* Ushey, Kevin, J. J. Allaire, and Yuan Tang. (2019). ‚ÄúReticulate: Interface to ‚ÄòPython.‚Äô‚Äù https://CRAN.R-project.org/package=reticulate.
* Xie, Y. and Allaire J.J. and Grolemund, G. (2018). R Markdown: The Definitive Guide. Chapman and Hall/CRC. ISBN 9781138359338. URL https://bookdown.org/yihui/rmarkdown.
* Xie, Y. (2019). xaringan: Presentation Ninja. R package version 0.9.  https://CRAN.R-project.org/package=xaringan
&lt;/small&gt;


---

&lt;a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"&gt;&lt;img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /&gt;&lt;/a&gt;&lt;br /&gt;&lt;span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"&gt;user2019 Tutorial: Taming Python to live in RStudio&lt;/span&gt; by &lt;span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName"&gt;Emma Rand&lt;/span&gt; is licensed under a &lt;a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"&gt;Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License&lt;/a&gt;.
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
